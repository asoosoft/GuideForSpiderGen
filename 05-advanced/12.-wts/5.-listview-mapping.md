---
description: 종목 데이터를 ListView 로 표현하는 예제
---

# 5. 종목 - ListView Mapping

대량의 데이터를 표현하는데 일반적으로 Table 형태의 컴포넌트를 사욯하지만,  Row 배열이 아닌 여러 비주얼적인 요소로 표현이 필요한 경우에는 LIstView  로도 사용이 가능합니다.



이전 프로젝트를 수정하여 진행합니다 [3.-grid-mapping-websocket.md](3.-grid-mapping-websocket.md "mention")



### 1. ListView Item 화면 생성 &#x20;

종목 개별로 내용을 표시할수 있도록 화면을 구성합니다.

* Source 폴더에서View 생성 &#x20;

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>



* 생성된 View 에  총 6개의  Label 로 화면 구성 (ListIViewtem.lay)

<div data-full-width="true"><figure><img src="../../.gitbook/assets/image (9) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure></div>

* lay 크기 조절하여 화면 완성

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>



### 2. Query Mapping &#x20;

이전 프로젝트에서 생성한 Query 를 각 Label 에 Mapping 합니다.

* 종목이름 Mapping
  * 종목이름Label 에서 Data Query 실행
  *

      <figure><img src="../../.gitbook/assets/image (6) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>


  * ChildMapping 으로  ticker 추가후,   cd 값으로 지정&#x20;
    *

        <figure><img src="../../.gitbook/assets/image (5) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>


  * ChildMapping 으로 rest\_ticker 추가후,  market 값으로 지정
    *

        <figure><img src="../../.gitbook/assets/image (8) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>


* 나머지 Label Mapping&#x20;
  * 위와 동일한 방법으로 나머지 Label 도 Query  Mapping 진행
    *

        <figure><img src="../../.gitbook/assets/image (10) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
    * 1- 현재가&#x20;
      * ticker - tp
      * rest\_ticker - trade\_price
    * 2- 전일대비
      * ticker - scp
      * rest\_ticker - signed\_change\_price
    * 3- 거래대금
      * ticker - atp24h
      * rest\_ticker - change\_rate

### 3. ListView 설정 (MainView.lay)

위에 생성한 ListViewItem.lay 를 ListView 에 추가될수 있도록 작업을 진행합니다.

*   기존프로젝트의 DataGrid 를 삭제하고, ListView 를 추가한후 ID 값을 listView 로 설정.

    <div data-full-width="true"><figure><img src="../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure></div>
*   ListView 에 Item 추가

    <figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>



    * 1- ListView 의 Attribute 탭으로 이동
    * 2- ListViewItem.lay 파일로부터  경로를 복사
    * 3- DefaultUrl 에 복사한 경로를 붙여서 설정 완료.

### 4. Query Mapping

ListView 에 QueryMapping 을 진행해서 각 추가되는 ListViewItem 에게 쿼리가 전달되도록 해야 합니다.

* LIstView 에 DataQuery 를 열고 ticker, rest\_ticker 등록하면 끝.

<figure><img src="../../.gitbook/assets/image (5) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>



### 5. listView 코드 작업 (MainView.js)

기존 코드에서 requestMarketData() 함수와 requestTickData 함수만 재적용 합니다&#x20;

* datagrid 변수제거
* &#x20;listview 에 쿼리 적용

```javascript
  // 종목 데이터 요청
    requestMarketData()
    {
        const containerId = this.getContainerId();
        this.qmRest.sendProcessByName('rest_market',containerId , null, queryData=>{
            queryData.getBlockData('InBlock1')[0].is_details = true;
        }, queryData=>{
            const outBlock = queryData.getBlockData('OutBlock1');

             const marketNamesArr = Object.values(outBlock)
             .filter(item => item.market.includes('KRW'))
             .map(item=>item.market);

             this.requestTickData(marketNamesArr, containerId);
        });
    }

    // 종목의 tick data 요청
    requestTickData(marketArr , containerId)
    {
        this.qmRest.sendProcessByName('rest_ticker', containerId, null, queryData=>{
            const block = queryData.getBlockData('InBlock1')[0];
            block.markets = marketArr;
        }, queryData=>
        {
            const outBlock = queryData.getBlockData('OutBlock1');
            outBlock.forEach(item=>{
                 item.cd = item.market
            });

            this.qmReal.registerReal('ticker', 'cd', marketArr, [this.listView], 0);
        });
    }
```



### 6. 결과 확인

<figure><img src="../../.gitbook/assets/image (6) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

* listViewItem 의 각 Label 에 코드작업없이 값이 입력되어있는지 확인.



### 7. 수치에 부호 적용

grid 말고도 일반 Component 에도 각 수치에 부호를 적용할수 있습니다.

* 현재가
  * label 선택 후 Class 탭 이동
  * mask 에 Number.money 추가

<figure><img src="../../.gitbook/assets/image (7) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

* 전일대비 (동일)
  * mask 에서 Number.percent 추가
* 거래대금 (동일)
  * mask 에서 Number.divide("10000", "1") 추가&#x20;
  * Number.money 추가
  * Text.suffix ("백만", "") 추가



### 8. 결과 재확인&#x20;

<figure><img src="../../.gitbook/assets/image (8) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

* 각 수치에 부호처리가 잘 되었는지 확인.



Download

{% file src="../../.gitbook/assets/WTSSample" %}


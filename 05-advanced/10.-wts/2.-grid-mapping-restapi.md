---
description: 거래소로부터 받은 종록들의 정보를 Grid 에 Mapping 된 정보를 통해 표현
---

# 2. 종목 - Grid Mapping (RestAPI)

Grid 에 값을 입력하는 방법은 2가지가 있습니다.

* Grid 의 열과 행에 코드로 데이터 추가.&#x20;
* Grid 에 데이터를 mapping 하여 자동화

거래소의 정보를 Grid Mapping 방식으로 표현하여 CodeBase 기반보다 간결함을 보여주는 에제입니다.

### 1. 모듈 추가 및 초기 로딩 모듈 선택

* sys Framework 추가
* Default Laod Setting  체크
  *

      <figure><img src="../../.gitbook/assets/image (184).png" alt=""><figcaption></figcaption></figure>
  * afc&#x20;
    * ADatamak.js
      * DnDManager.js
      * AIndicator.js
  * sys&#x20;
    * AQuery.js
    * AQueryData.js&#x20;
    * QueryManager.js
    * HttpIO.js
    * NetworkIO.js
    * QueryManager.js
    * WebSocketIO.js



### 2.  거래소 통신 모듈 생성 (UpbitHttpIO.js)

```javascript
class UbHttpIO extends HttpIO
{
	constructor(listener)
	{
		super(listener)		
	}

    //업비트 API호출이라 업비트 WAS에서 분배되어야할 내용을 이곳에서 처리함.
    //공통으로 처리하기 애매하기때문에 SWITCH문으로 분배함.
	sendData(data, callback)
	{
        const packetId = data.header.packetId;

        const apiUrl = this.makeAPIUrl(data);

        if(!apiUrl)
        {
            this.onError(packetId, new Error('Can not make api'));
            return;
        }
        
        console.log(apiUrl)
		fetch(apiUrl).then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        }).then(data => {
			this.listener.packetInfo.packetId = packetId;
            this.onReceived(data, data.length);
        }).catch(error => {
            //this.onError(packetId, error);
            console.error('api error', error);
        });
    }

    //일단 사용자 input값은 inblock1[0]에 있음 무조건 다른 경우는 없음.
    makeAPIUrl(data)
    {
        const block = data.body.InBlock1[0];

        let url = this.url;
        url += data.header.url;
        
        let paramStr = '';
        if(block) {
            paramStr = '?';
            for(let key in block) {
                if(block[key]) {
                    if(paramStr.length > 1) paramStr += '&';
                    paramStr += `${key}=${block[key]}`;
                }
            }

            url += paramStr;
        }
        return url;
    }
	
    onReceived(result, packetId, isToSignal)
    {
	if(this.listener) this.listener.onReceived(result, packetId, isToSignal)
    }
	
    onError(packetId, errorObj, isToSignal)
    {
	if(this.listener.onError) this.listener.onError(packetId, errorObj, isToSignal);
    }
}

```



\






